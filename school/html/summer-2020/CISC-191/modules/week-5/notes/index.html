<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="generator" content="pandoc">
    <meta name="description" content="">
    <meta name="author" content="Mark Lucernas">
    <meta name="dcterms.date" content="2020-07-14">

    <title>Concurrency, Threads and Multiprocessing</title>

    <!-- For animated toc sidebar -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css" rel="stylesheet" type="text/css">
    <link href="../../../../../../../templates/css/animated-toc.css" rel="stylesheet">
    <!-- Bootstrap core CSS -->
    <link href="../../../../../../../templates/css/bootstrap.min.css" rel="stylesheet">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../../../../../../templates/css/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="../../../../../../../templates/css/dashboard.css" rel="stylesheet">
    <style type="text/css">code{white-space: pre;}</style>
    <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style>
  </head>

  <body>

<!-- Nav bar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">School Wiki</a>
        </div>
        <!-- <div id="navbar" class="navbar-collapse collapse">                                                                                                                 -->
        <!--   <ul class="nav navbar-nav">                                                                                                                                      -->
        <!--     <li><a href="#">doc1</a></li>                                                                                                                                  -->
        <!--     <li><a href="#">doc2</a></li>                                                                                                                                  -->
        <!--     <li><a href="#">doc3</a></li>                                                                                                                                  -->
        <!--     <li class="dropdown">                                                                                                                                          -->
        <!--       <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a> -->
        <!--       <ul class="dropdown-menu">                                                                                                                                   -->
        <!--         <li><a href="#">Action</a></li>                                                                                                                            -->
        <!--         <li><a href="#">Another action</a></li>                                                                                                                    -->
        <!--         <li><a href="#">Something else here</a></li>                                                                                                               -->
        <!--         <li role="separator" class="divider"></li>                                                                                                                 -->
        <!--         <li class="dropdown-header">Nav header</li>                                                                                                                -->
        <!--         <li><a href="#">Separated link</a></li>                                                                                                                    -->
        <!--         <li><a href="#">One more separated link</a></li>                                                                                                           -->
        <!--       </ul>                                                                                                                                                        -->
        <!--     </li>                                                                                                                                                          -->
        <!--   </ul>                                                                                                                                                            -->
        <!-- </div>                                                                                                                                                             -->
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">

<!-- Table of Contents -->
        <nav id="sidebar" class="col-sm-3 col-md-2 sidebar toc">
          <ul>
          <li><a href="#week-5-concurrency-threads-and-multiprocessing">Week 5: Concurrency, Threads and Multiprocessing</a><ul>
          <li><a href="#the-thread-class">The Thread Class</a><ul>
          <li><a href="#the-static-yield-method">The Static yield() Method</a></li>
          <li><a href="#the-static-sleepmilliseconds-method">The Static sleep(milliseconds) Method</a></li>
          <li><a href="#the-join-method">The join() Method</a></li>
          <li><a href="#isalive-interrupt-and-isinterrupted">isAlive(), interrupt(), and isInterrupted()</a></li>
          </ul></li>
          <li><a href="#thread-pools">Thread Pools</a><ul>
          <li><a href="#thread-synchronization">Thread Synchronization</a></li>
          <li><a href="#race-condition">Race Condition</a></li>
          <li><a href="#the-synchronized-keyword">The synchronized keyword</a></li>
          <li><a href="#synchronizing-instance-methods-and-static-methods">Synchronizing Instance Methods and Static Methods</a></li>
          <li><a href="#synchronizing-statements">Synchronizing Statements</a></li>
          <li><a href="#synchronizing-statements-vs.-methods">Synchronizing Statements vs.Â Methods</a></li>
          <li><a href="#synchronization-using-locks">Synchronization Using Locks</a></li>
          <li><a href="#fairness-policy">Fairness Policy</a></li>
          <li><a href="#cooperation-among-threads">Cooperation Among Threads</a></li>
          <li><a href="#javas-built-in-monitors">Javaâ€™s Built-in Monitors</a><ul>
          <li><a href="#wait-notify-and-notifyall">wait(), notify(), and notifyAll()</a></li>
          </ul></li>
          <li><a href="#blocking-queues">Blocking Queues</a><ul>
          <li><a href="#concrete-blocking-queues">Concrete Blocking Queues</a></li>
          </ul></li>
          <li><a href="#semaphores">Semaphores</a><ul>
          <li><a href="#creating-semaphores">Creating Semaphores</a></li>
          </ul></li>
          <li><a href="#deadlock">Deadlock</a><ul>
          <li><a href="#preventing-deadlock">Preventing Deadlock</a></li>
          </ul></li>
          <li><a href="#thread-states">Thread States</a></li>
          <li><a href="#synchronized-collections">Synchronized Collections</a></li>
          <li><a href="#the-forkjoin-framework">The Fork/Join Framework</a></li>
          <li><a href="#vector-stack-and-hashtable">Vector, Stack, and Hashtable</a></li>
          <li><a href="#fail-fast">Fail-Fast</a></li>
          </ul></li>
          </ul></li>
          <li><a href="#resources">Resources</a></li>
          </ul>
          <svg class="toc-marker" width="200" height="200" xmlns="http://www.w3.org/2000/svg">
            <path stroke="#444" stroke-width="3" fill="transparent" stroke-dasharray="0, 0, 0, 1000" stroke-linecap="round" stroke-linejoin="round" transform="translate(-0.5, -0.5)" />
          </svg>
        </nav>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">

<!-- Header -->
          <header>
            <div class="jumbotron">
              <div class="page-header">
                <a href="../../../../../index.html">Wiki Root</a> | <a href="../index.html">index</a>
                <h1 class="title">
                  Concurrency, Threads and Multiprocessing
                </h1>
                <hr style="border: 1px solid grey;border-radius: 5px;">
                <h4 class="summary" style="text-align: center;">Week 5 Concurrency, Threads and Multiprocessing</h4>
              </div>
            </div>
          </header>
          <div class="h5 text-muted">
            <h5 class="author">Mark Lucernas</h5>
            <h5 class="date">2020-07-14</h5>
          </div>

<!-- Contents -->
          <article class="contents">
<h1 id="week-5-concurrency-threads-and-multiprocessing">Week 5: Concurrency, Threads and Multiprocessing</h1>
<ul>
<li><a href="../../../../../../files/summer-2020/CISC-191/week-5/concurrency.ppt">â¬‡ Concurrency</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/TaskThreadDemo.html">ðŸ“„ TaskThreadDemo.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/FlashText.html">ðŸ“„ FlashTest.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ExecutorDemo.html">ðŸ“„ ExecutorDemo.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/AccountWithoutSync.html">ðŸ“„ AccountWithoutSync.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/AccountWithSyncUsingLock.html">ðŸ“„ AccountWithSyncUsingLock</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ThreadCooperation.html">ðŸ“„ ThreadCooperation.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ConsumerProducer.html">ðŸ“„ ConsumerProducer.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ConsumerProducerUsingBlockingQueue.html">ðŸ“„ ConsumerProducerUsingBlockingQueue.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ParallelMergeSort.html">ðŸ“„ ParallelMergeSort</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ParallelMax.html">ðŸ“„ ParallelMax</a></li>
<li><a href="https://www.youtube.com/watch?v=F-CkaU8aQZI">ðŸ“º Basic Threading</a></li>
<li><a href="https://www.youtube.com/watch?v=G2Xd5avyk_0">ðŸ“º Advanced Threading: Locking, ThreadPools</a></li>
<li><a href="https://www.youtube.com/watch?v=YdlnEWC-7Wo&amp;list=PLBB24CFB073F1048E&amp;index=1">ðŸ“º Advanced Java: Multi-threading Playlist</a></li>
</ul>
<p>Multi-threading Video Tutorial Series</p>
<ul>
<li><a href="multi-threading-tutorial.html">â†ª Multi-threading Playlist Source Code</a></li>
</ul>
<h2 id="the-thread-class">The Thread Class</h2>
<h3 id="the-static-yield-method">The Static yield() Method</h3>
<p>You can use the <code>yield()</code> method to temporarily release time for other threads.</p>
<h3 id="the-static-sleepmilliseconds-method">The Static sleep(milliseconds) Method</h3>
<p>The <code>sleep(long mills)</code> method puts the thread to sleep for the specified time in milliseconds.</p>
<h3 id="the-join-method">The join() Method</h3>
<p>You can use the <code>join()</code> method to force one thread to wait for another thread to finish.</p>
<h3 id="isalive-interrupt-and-isinterrupted">isAlive(), interrupt(), and isInterrupted()</h3>
<p>The <code>isAlive()</code> method is used to find out the state of a thread. It returns true if a thread is in the Ready, Blocked, or Running state; it returns false if a thread is new and has not started or if it is finished.</p>
<p>The <code>interrupt()</code> method interrupts a thread in the following way: If a thread is currently in the Ready or Running state, its interrupted flag is set; if a thread is currently blocked, it is awakened and enters the Ready state, and an java.io.InterruptedException is thrown.</p>
<p>The <code>isInterrupt()</code> method tests whether the thread is interrupted.</p>
<h2 id="thread-pools">Thread Pools</h2>
<p>Starting a new thread for each task could limit throughput and cause poor performance. A thread pool is ideal to manage the number of tasks executing concurrently. JDK 1.5 uses the Executor interface for executing tasks in a thread pool and the ExecutorService interface for managing and controlling tasks. ExecutorService is a subinterface of Executor.</p>
<h3 id="thread-synchronization">Thread Synchronization</h3>
<p>A shared resource may be corrupted if it is accessed simultaneously by multiple threads. For example, two unsynchronized threads accessing the same bank account may cause conflict.</p>
<h3 id="race-condition">Race Condition</h3>
<p>The problem is that Task 1 and Task 2 are accessing a common resource in a way that causes conflict. This is a common problem known as a <code>race condition</code> in multithreaded programs.</p>
<p>A class is said to be thread-safe if an object of the class does not cause a race condition in the presence of multiple threads.</p>
<h3 id="the-synchronized-keyword">The synchronized keyword</h3>
<p>To avoid race conditions, more than one thread must be prevented from simultaneously entering certain part of the program, known as critical region. The critical region in the Listing 32.5 is the entire deposit method. You can use the <code>synchronized</code> keyword to synchronize the method so that only one thread can access the method at a time. There are several ways to correct the problem in Listing 32.5, one approach is to make Account thread-safe by adding the <code>synchronized</code> keyword in the deposit method in Line 45 as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">public</span> <span class="kw">synchronized</span> <span class="dt">void</span> <span class="fu">deposit</span>(<span class="dt">double</span> amount)</a></code></pre></div>
<h3 id="synchronizing-instance-methods-and-static-methods">Synchronizing Instance Methods and Static Methods</h3>
<p>A synchronized method acquires a lock before it executes. In the case of an instance method, the lock is on the object for which the method was invoked. In the case of a static method, the lock is on the class. If one thread invokes a synchronized instance method (respectively, static method) on an object, the lock of that object (respectively, class) is acquired first, then the method is executed, and finally the lock is released. Another thread invoking the same method of that object (respectively, class) is blocked until the lock is released.</p>
<h3 id="synchronizing-statements">Synchronizing Statements</h3>
<p><strong>Invoking a synchronized instance method of an object acquires a lock on the object, and invoking a synchronized static method of a class acquires a lock on the class.</strong> A synchronized statement can be used to acquire a lock on any object, not just this object, when executing a block of the code in a method. This block is referred to as a synchronized block. The general form of a synchronized statement is as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">synchronized</span> (expr) {</a>
<a class="sourceLine" id="cb2-2" title="2">  statements;</a>
<a class="sourceLine" id="cb2-3" title="3">}</a></code></pre></div>
<p>The expression expr must evaluate to an object reference. If the object is already locked by another thread, the thread is blocked until the lock is released. When a lock is obtained on the object, the statements in the synchronized block are executed, and then the lock is released.</p>
<h3 id="synchronizing-statements-vs.-methods">Synchronizing Statements vs.Â Methods</h3>
<p>Any synchronized instance method can be converted into a synchronized statement. Suppose that the following is a synchronized instance method:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">public</span> <span class="kw">synchronized</span> <span class="dt">void</span> <span class="fu">xMethod</span>() {</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="co">// method body</span></a>
<a class="sourceLine" id="cb3-3" title="3">}</a></code></pre></div>
<p>This method is equivalent to</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">public</span> <span class="dt">void</span> <span class="fu">xMethod</span>() {</a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">synchronized</span> (<span class="kw">this</span>) {</a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="co">// method body</span></a>
<a class="sourceLine" id="cb4-4" title="4">  }</a>
<a class="sourceLine" id="cb4-5" title="5">}</a></code></pre></div>
<h3 id="synchronization-using-locks">Synchronization Using Locks</h3>
<p>A synchronized instance method implicitly acquires a lock on the instance before it executes the method.</p>
<p>JDK 1.5 enables you to use locks explicitly. The new locking features are flexible and give you more control for coordinating threads. A lock is an instance of the Lock interface, which declares the methods for acquiring and releasing locks. A lock may also use the <code>newCondition()</code> method to create any number of Condition objects, which can be used for thread communications.</p>
<h3 id="fairness-policy">Fairness Policy</h3>
<p><code>ReentrantLock</code> is a concrete implementation of <code>Lock</code> for creating mutual exclusive locks. You can create a lock with the specified fairness policy. <strong>True fairness policies guarantee the longest-wait thread to obtain the lock first.</strong> False fairness policies grant a lock to a waiting thread without any access order. Programs using fair locks accessed by many threads may have poor overall performance than those using the default setting, but have smaller variances in times to obtain locks and guarantee lack of starvation.</p>
<h3 id="cooperation-among-threads">Cooperation Among Threads</h3>
<p>The conditions can be used to facilitate communications among threads. A thread can specify what to do under a certain condition. Conditions are objects created by invoking the <code>newCondition()</code> method on a Lock object. Once a condition is created, you can use its <code>await(),</code> <code>signal(),</code> and <code>signalAll()</code> methods for thread communications. The <code>await()</code> method causes the current thread to wait until the condition is signaled. The <code>signal()</code> method wakes up one waiting thread, and the <code>signalAll()</code> method wakes all waiting threads.</p>
<h3 id="javas-built-in-monitors">Javaâ€™s Built-in Monitors</h3>
<p>Locks and conditions are new in Java 5. Prior to Java 5, thread communications are programmed using objectâ€™s built-in monitors. Locks and conditions are more powerful and flexible than the built-in monitor. For this reason, this section can be completely ignored. However, if you work with legacy Java code, you may encounter the Javaâ€™s built-in monitor. A monitor is an object with mutual exclusion and synchronization capabilities. Only one thread can execute a method at a time in the monitor. A thread enters the monitor by acquiring a lock on the monitor and exits by releasing the lock. Any object can be a monitor. An object becomes a monitor once a thread locks it. Locking is implemented using the synchronized keyword on a method or a block. A thread must acquire a lock before executing a synchronized method or block. A thread can wait in a monitor if the condition is not right for it to continue executing in the monitor.</p>
<h4 id="wait-notify-and-notifyall">wait(), notify(), and notifyAll()</h4>
<p>Use the <code>wait(),</code> <code>notify(),</code> and <code>notifyAll()</code> methods to facilitate communication among threads.</p>
<p>The <code>wait(),</code> <code>notify(),</code> and <code>notifyAll()</code> methods must be called in a synchronized method or a synchronized block on the calling object of these methods. Otherwise, an IllegalMonitorStateException would occur.</p>
<p>The <code>wait()</code> method lets the thread wait until some condition occurs. When it occurs, you can use the <code>notify()</code> or <code>notifyAll()</code> methods to notify the waiting threads to resume normal execution. The <code>notifyAll()</code> method wakes up all waiting threads, while <code>notify()</code> picks up only one thread from a waiting queue.</p>
<h3 id="blocking-queues">Blocking Queues</h3>
<p>A blocking queue causes a thread to block when you try to add an element to a full queue or to remove an element from an empty queue.</p>
<h4 id="concrete-blocking-queues">Concrete Blocking Queues</h4>
<p>Three concrete blocking queues <code>ArrayBlockingQueue</code>, <code>LinkedBlockingQueue</code>, and <code>PriorityBlockingQueue</code> are supported in JDK 1.5. All are in the <code>java.util.concurrent</code> package. <code>ArrayBlockingQueue</code> implements a blocking queue using an array. You have to specify a capacity or an optional fairness to construct an <code>ArrayBlockingQueue.</code> <code>LinkedBlockingQueue</code> implements a blocking queue using a linked list. You may create an unbounded or bounded <code>LinkedBlockingQueue.</code> <code>PriorityBlockingQueue</code> is a priority queue. You may create an unbounded or bounded priority queue.</p>
<h3 id="semaphores">Semaphores</h3>
<p>Semaphores can be used to restrict the number of threads that access a shared resource. Before accessing the resource, a thread must acquire a permit from the semaphore. After finishing with the resource, the thread must return the permit back to the semaphore.</p>
<h4 id="creating-semaphores">Creating Semaphores</h4>
<p>To create a semaphore, you have to specify the number of permits with an optional fairness policy. A task acquires a permit by invoking the semaphoreâ€™s <code>acquire()</code> method and releases the permit by invoking the semaphoreâ€™s <code>release()</code> method. Once a permit is acquired, the total number of available permits in a semaphore is reduced by 1. Once a permit is released, the total number of available permits in a semaphore is increased by 1.</p>
<h3 id="deadlock">Deadlock</h3>
<p>Sometimes two or more threads need to acquire the locks on several shared objects. This could cause deadlock, in which each thread has the lock on one of the objects and is waiting for the lock on the other object. Consider the scenario with two threads and two objects. Thread 1 acquired a lock on object1 and Thread 2 acquired a lock on object2. Now Thread 1 is waiting for the lock on object2 and Thread 2 for the lock on object1. The two threads wait for each other to release the in order to get the lock, and neither can continue to run.</p>
<p>Thread 1</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">synchronized</span> (object1) {</a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="co">// do something here</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="kw">synchronized</span> (object2) { <span class="co">// Wait for Thread 2 to release the lock on object 2</span></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="co">// do something here</span></a>
<a class="sourceLine" id="cb5-5" title="5">  }</a>
<a class="sourceLine" id="cb5-6" title="6">}</a></code></pre></div>
<p>Thread 2</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">synchronized</span> (object2) {</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="co">// do something here</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="kw">synchronized</span> (object1) { <span class="co">// Wait for Thread 1 to release the lock on object 1</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="co">// do something here</span></a>
<a class="sourceLine" id="cb6-5" title="5">  }</a>
<a class="sourceLine" id="cb6-6" title="6">}</a></code></pre></div>
<h4 id="preventing-deadlock">Preventing Deadlock</h4>
<p>Deadlock can be easily avoided by using a simple technique known as resource ordering. With this technique, you assign an order on all the objects whose locks must be acquired and ensure that each thread acquires the locks in that order. For the example, suppose the objects are ordered as object1 and object2. Using the resource ordering technique, Thread 2 must acquire a lock on object1 first, then on object2. Once Thread 1 acquired a lock on object1, Thread 2 has to wait for a lock on object1. So Thread 1 will be able to acquire a lock on object2 and no deadlock would occur.</p>
<h3 id="thread-states">Thread States</h3>
<p>A thread can be in one of five states: New, Ready, Running, Blocked, or Finished.</p>
<h3 id="synchronized-collections">Synchronized Collections</h3>
<p>The classes in the Java Collections Framework are not thread-safe, i.e., the contents may be corrupted if they are accessed and updated concurrently by multiple threads. You can protect the data in a collection by locking the collection or using synchronized collections.</p>
<p>The Collections class provides six static methods for wrapping a collection into a synchronized version. The collections created using these methods are called synchronization wrappers.</p>
<h3 id="the-forkjoin-framework">The Fork/Join Framework</h3>
<p>The widespread use of multicore systems has created a revolution in software. In order to benefit from multiple processors, software needs to run in parallel.</p>
<p>JDK 7 introduces the new Fork/Join Framework for parallel programming, which utilizes the multicore processors.</p>
<h3 id="vector-stack-and-hashtable">Vector, Stack, and Hashtable</h3>
<p>Invoking synchronizedCollection(Collection c) returns a new Collection object, in which all the methods that access and update the original collection c are synchronized. These methods are implemented using the synchronized keyword. For example, the add method is implemented like this:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">add</span>(E o) {</a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="kw">synchronized</span> (<span class="kw">this</span>) { <span class="kw">return</span> c.<span class="fu">add</span>(o); }</a>
<a class="sourceLine" id="cb7-3" title="3">}</a></code></pre></div>
<p>The synchronized collections can be safely accessed and modified by multiple threads concurrently.</p>
<p>The methods in java.util.Vector, java.util.Stack, and Hashtable are already synchronized. These are old classes introduced in JDK 1.0. In JDK 1.5, you should use java.util.ArrayList to replace Vector, java.util.LinkedList to replace Stack, and java.util.Map to replace Hashtable. If synchronization is needed, use a synchronization wrapper.</p>
<h3 id="fail-fast">Fail-Fast</h3>
<p>The synchronization wrapper classes are thread-safe, but the iterator is fail-fast. This means that if you are using an iterator to traverse a collection while the underlying collection is being modified by another thread, then the iterator will immediately fail by throwing <code>java.util.ConcurrentModificationException</code>, which is a subclass of <code>RuntimeException</code>. To avoid this error, you need to create a synchronized collection object and acquire a lock on the object when traversing it. For example, suppose you want to traverse a set, you have to write the code like this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb8-1" title="1"><span class="bu">Set</span> hashSet = <span class="bu">Collections</span>.<span class="fu">synchronizedSet</span>(<span class="kw">new</span> <span class="bu">HashSet</span>());</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">synchronized</span> (hashSet) { <span class="co">// Must synchronize it</span></a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="bu">Iterator</span> iterator = hashSet.<span class="fu">iterator</span>();</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="kw">while</span> (iterator.<span class="fu">hasNext</span>()) {</a>
<a class="sourceLine" id="cb8-5" title="5">    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(iterator.<span class="fu">next</span>());</a>
<a class="sourceLine" id="cb8-6" title="6">  }</a>
<a class="sourceLine" id="cb8-7" title="7">}</a></code></pre></div>
<p>Failure to do so may result in nondeterministic behavior, such as <code>ConcurrentModificationException</code>.</p>
<p><br></p>
<h1 id="resources">Resources</h1>
<ul>
<li><a href="../../../../../../files/summer-2020/CISC-191/week-5/concurrency.ppt">â¬‡ Concurrency</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/TaskThreadDemo.html">ðŸ“„ TaskThreadDemo.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/FlashText.html">ðŸ“„ FlashTest.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ExecutorDemo.html">ðŸ“„ ExecutorDemo.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/AccountWithoutSync.html">ðŸ“„ AccountWithoutSync.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/AccountWithSyncUsingLock.html">ðŸ“„ AccountWithSyncUsingLock</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ThreadCooperation.html">ðŸ“„ ThreadCooperation.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ConsumerProducer.html">ðŸ“„ ConsumerProducer.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ConsumerProducerUsingBlockingQueue.html">ðŸ“„ ConsumerProducerUsingBlockingQueue.java</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ParallelMergeSort.html">ðŸ“„ ParallelMergeSort</a></li>
<li><a href="https://liveexample.pearsoncmg.com/html/ParallelMax.html">ðŸ“„ ParallelMax</a></li>
<li><a href="https://www.youtube.com/watch?v=F-CkaU8aQZI">ðŸ“º Basic Threading</a></li>
<li><a href="https://www.youtube.com/watch?v=G2Xd5avyk_0">ðŸ“º Advanced Threading: Locking, ThreadPools</a></li>
<li><a href="https://www.youtube.com/watch?v=YdlnEWC-7Wo&amp;list=PLBB24CFB073F1048E&amp;index=1">ðŸ“º Advanced Java: Multi-threading Playlist</a></li>
</ul>
          </article>
          </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../../../../../../templates/js/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../../../../../../../templates/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../../../../../../templates/js/ie10-viewport-bug-workaround.js"></script>
    <script>
        //document.getElementById('sidebar').getElementsByTagName('ul')[0].className += "nav nav-sidebar";

        /* ajust the height when click the toc
           the code is from https://github.com/twbs/bootstrap/issues/1768
        */
        var shiftWindow = function() { scrollBy(0, -50) };
        window.addEventListener("hashchange", shiftWindow);
        function load() { if (window.location.hash) shiftWindow(); }

        /*add Bootstrap styles to tables*/
        var tables = document.getElementsByTagName("table");
        for(var i = 0; i < tables.length; ++i){
            tables[i].className += "table table-bordered table-hover";
        }
    </script>
    <script src="../../../../../../../templates/js/animated-toc.js"></script>
  </body>
</html>
